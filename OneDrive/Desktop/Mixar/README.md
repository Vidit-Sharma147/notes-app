# Mesh Normalization, Quantization, and Error Analysis

## Project Structure

```
Mixar/
│
├── README.md                           # This file - setup and usage instructions
├── requirements.txt                    # Python dependencies (numpy, trimesh, matplotlib, open3d)
├── ASSIGNMENT_SUBMISSION.md            # Complete assignment report (convert to PDF for submission)
│
├── scripts/
│   ├── mesh_preprocess.py              # Main script: loads meshes, normalizes, quantizes, measures errors
│   └── aggregate_and_render.py         # Aggregates results, creates comparison plots, renders screenshots
│
├── samples/
│   └── 8samples (1)/
│       └── 8samples/                   # Input folder containing 8 .obj mesh files
│           ├── branch.obj              # Sample mesh files
│           ├── cylinder.obj
│           ├── explosive.obj
│           ├── fence.obj
│           ├── girl.obj
│           ├── person.obj
│           ├── table.obj
│           └── talwar.obj
│
└── outputs/                            # All results generated by the scripts
    ├── 8samples (1)/                   # Results grouped by sample folder
    │   ├── branch/                     # Results for branch mesh
    │   │   ├── minmax/                 # Min-Max normalization results
    │   │   │   ├── quantized.npz       # Quantized integer coordinates [0-1023]
    │   │   │   ├── reconstructed_vertices.npz  # Reconstructed vertex positions
    │   │   │   ├── branch_reconstructed.ply    # Reconstructed mesh file
    │   │   │   ├── error_per_axis.png  # Bar chart showing error on X, Y, Z axes
    │   │   │   ├── error_hist.png      # Histogram of error distribution
    │   │   │   └── summary.txt         # MSE, MAE, and other metrics
    │   │   └── unit_sphere/            # Unit Sphere normalization results (same structure)
    │   ├── cylinder/                   # (same structure as branch)
    │   ├── explosive/
    │   ├── fence/
    │   ├── girl/
    │   ├── person/
    │   ├── table/
    │   └── talwar/
    │
    └── aggregate/                      # Combined analysis of all meshes
        ├── aggregate_summary.csv       # All error metrics in one table
        ├── mse_comparison.png          # Bar chart comparing MSE across all meshes
        ├── mae_comparison.png          # Bar chart comparing MAE across all meshes
        └── visuals/                    # Rendered screenshots of reconstructed meshes
            ├── 8samples_(1)_branch_minmax.ply.png
            ├── 8samples_(1)_branch_unit_sphere.ply.png
            └── ... (16 screenshots total)
```

### File Types Explained

- **`.obj`** - Original 3D mesh files (vertices and faces)
- **`.ply`** - Reconstructed 3D mesh files after quantization/dequantization
- **`.npz`** - Compressed NumPy arrays (quantized coordinates or reconstructed vertices)
- **`.txt`** - Text summaries with error metrics
- **`.png`** - Visualization plots (error analysis, comparisons, screenshots)
- **`.csv`** - Spreadsheet with all numerical results
- **`.py`** - Python scripts
- **`.md`** - Markdown documentation

---

## Quick Start (Windows PowerShell)

### 1. Create a virtual environment (optional but recommended)
```powershell
python -m venv .venv
.\.venv\Scripts\Activate.ps1
```

### 2. Install dependencies
```powershell
python -m pip install -r requirements.txt
```

### 3. Run the preprocessing
```powershell
python .\scripts\mesh_preprocess.py --input_dir "samples\8samples (1)" --out_dir outputs --bins 1024 --group_by_dir
```

### 4. Generate aggregate analysis and visualizations
```powershell
python .\scripts\aggregate_and_render.py --outputs_dir outputs --out_dir outputs\aggregate
```

---

## What the Scripts Do

### mesh_preprocess.py
1. **Loads** .obj mesh files and extracts vertices
2. **Prints** statistics (vertex count, min, max, mean, std dev)
3. **Normalizes** using two methods:
   - **Min-Max:** Maps each axis to [0, 1] independently
   - **Unit Sphere:** Centers at centroid, scales to fit in unit sphere
4. **Quantizes** to 1024 bins per axis (integers 0-1023)
5. **Dequantizes** back to floating point
6. **Denormalizes** to original scale
7. **Measures errors** (MSE and MAE)
8. **Saves** reconstructed meshes, plots, and metrics

### aggregate_and_render.py
1. **Collects** all summary.txt files
2. **Creates** CSV with all error metrics
3. **Generates** comparison plots (MSE and MAE across all meshes)
4. **Renders** screenshots of reconstructed meshes using Open3D

---

## Output Files Per Mesh/Method

Each mesh-method combination produces:
- quantized.npz                 : quantized integer coordinates
- reconstructed_vertices.npz    : reconstructed vertex positions as numpy
- <mesh>_reconstructed.ply      : reconstructed mesh (or point cloud)
- error_per_axis.png            : bar plot of mean absolute error per axis
- error_hist.png                : histogram of per-vertex L2 error
- **summary.txt** - Numeric summary with MSE, MAE, and metadata

---

## Advanced Usage

### Process a Single Mesh
```powershell
python .\scripts\mesh_preprocess.py --input_dir samples --sample "8samples (1)\8samples\girl.obj" --out_dir outputs --bins 1024
```

### Process with Custom Output Path Template
```powershell
python .\scripts\mesh_preprocess.py --input_dir samples --sample "8samples (1)" --out_dir outputs --out_template "{out_dir}\{group}\{name}" --bins 1024
```

Template variables:
- `{out_dir}` - Base output directory
- `{group}` - Parent folder name
- `{name}` - Mesh filename (without extension)

### Change Quantization Bins
```powershell
python .\scripts\mesh_preprocess.py --input_dir samples --out_dir outputs --bins 2048 --group_by_dir
```

---

## Results Summary

The processing generates approximately **100+ files** including:
- 8 meshes × 2 methods = **16 reconstructed meshes**
- 16 × 2 plots = **32 error visualization plots**
- **16 rendered screenshots** of reconstructed meshes
- **1 aggregate CSV** with all metrics
- **2 comparison plots** (MSE and MAE)

### Key Findings
- **Min-Max normalization** achieves 2-3× lower reconstruction error than Unit Sphere
- **1024 bins** provide excellent precision (MAE ~10⁻⁴ to 10⁻³)
- Error patterns are consistent across all mesh types

---

## Notes

- The script handles degenerate axes (where vmax == vmin) with division by zero protection
- Preserves mesh faces when available; otherwise saves as point cloud
- All visualizations use matplotlib for plots and Open3D for 3D rendering

---

## Viewing Results

- **Meshes:** Open `.ply` files in MeshLab, Blender, or Open3D viewer
- **Plots:** View `.png` files directly
- **Metrics:** Check `summary.txt` files or `aggregate_summary.csv`
- **Full Report:** See `ASSIGNMENT_SUBMISSION.md` (convert to PDF for submission)

